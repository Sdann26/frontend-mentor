import e from"glob";import t from"plugin-error";import r from"purgecss";import n from"through2";function o(o){return n.obj((async function(s,c,i){if(s.isNull())return i(null,s);if(s.isBuffer())try{const t={...o,content:(u=o.content,u.reduce(((t,r)=>[...t,...e.sync(r)]),[])),css:[{raw:s.contents.toString()}],stdin:!0},n=(await(new r).purge(t))[0],c=t.rejected&&n.rejected?n.rejected.join(" {}\n")+" {}":n.css;s.contents=Buffer.from(c,"utf-8"),i(null,s)}catch(e){e instanceof Error&&this.emit("error",new t("gulp-purgecss",e.message))}var u;if(s.isStream()){let e="";s.contents.on("data",(t=>{e+=t.toString()})).on("end",(async()=>{try{const t={...o,css:[{raw:e}]},c=(await(new r).purge(t))[0],u=t.rejected&&c.rejected?c.rejected.join(" {}\n")+" {}":c.css,f=n();f.write(Buffer.from(u,"utf-8")),s.contents=s.contents.pipe(f),i(null,s)}catch(e){e instanceof Error&&this.emit("error",new t("gulp-purgecss",e.message))}}))}}))}export{o as default};
